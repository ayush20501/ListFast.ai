<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Profile - ListFast.ai</title>
    <link rel="icon" href="data:,">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
        }

        .hero-gradient {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 50%, #4facfe 100%);
            background-size: 200% 200%;
            animation: gradientShift 8s ease-in-out infinite;
        }

        @keyframes gradientShift {

            0%,
            100% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }
        }

        .navbar-backdrop {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(229, 231, 235, 0.5);
        }

        .nav-link {
            position: relative;
            overflow: hidden;
        }

        .nav-link::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 2px;
            background: linear-gradient(135deg, #f093fb 0%, #4facfe 100%);
            transition: all 0.3s ease;
            transform: translateX(-50%);
        }

        .nav-link:hover::before {
            width: 100%;
        }

        .logo-link {
            transition: filter 0.3s ease;
        }

        .logo-link:hover {
            filter: brightness(1.1);
            transform: none;
        }

        .profile-dropdown {
            transition: all 0.3s ease;
            transform: scale(0.95);
            opacity: 0;
            visibility: hidden;
        }

        .profile-dropdown.active {
            transform: scale(1);
            opacity: 1;
            visibility: visible;
        }

        .hamburger-line {
            width: 24px;
            height: 3px;
            background-color: #374151;
            margin: 3px 0;
            transition: 0.3s;
            border-radius: 3px;
        }

        .hamburger.open .hamburger-line:nth-child(1) {
            transform: rotate(-45deg) translate(-5px, 6px);
        }

        .hamburger.open .hamburger-line:nth-child(2) {
            opacity: 0;
        }

        .hamburger.open .hamburger-line:nth-child(3) {
            transform: rotate(45deg) translate(-5px, -6px);
        }

        .mobile-menu {
            transition: all 0.3s ease-in-out;
            max-height: 0;
            overflow: hidden;
        }

        .mobile-menu.active {
            max-height: 500px;
        }

        .input-field {
            transition: all 0.3s ease;
            border: 2px solid #e5e7eb;
        }

        .input-field:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }

        .card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 2px solid transparent;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card:hover {
            border: 2px solid #3b82f6;
            background: linear-gradient(135deg, #ffffff 0%, #eff6ff 100%);
            transform: translateY(-2px);
            box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.1);
        }

        .stat-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.2);
        }

        .listing-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            transition: all 0.3s ease;
            border: 1px solid rgba(229, 231, 235, 0.8);
        }

        .listing-card:hover {
            background: linear-gradient(135deg, #ffffff 0%, #eff6ff 100%);
            border-color: #3b82f6;
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .upload-area {
            transition: all 0.3s ease;
        }

        .upload-area:hover {
            background: #f3f4f6;
            border-color: #3b82f6;
            transform: scale(1.02);
        }

        .profile-image {
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .profile-image:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        @media (max-width: 640px) {
            .card {
                margin-bottom: 1rem;
            }

            .stat-card {
                padding: 1rem;
            }
        }

        /* Remove hover movement effects */
        .card:hover {
            transform: none !important;
        }

        .stat-card:hover {
            transform: none !important;
        }

        .listing-card:hover {
            transform: none !important;
        }

        .upload-area:hover {
            transform: none !important;
        }

        .profile-image:hover {
            transform: none !important;
        }
    </style>
</head>

<body class="min-h-screen bg-gray-50">
    <img id="user-profile-pic" src="" alt="" style="display: none;">
    <img id="mobile-user-profile-pic" src="" alt="" style="display: none;">
    <nav class="navbar-backdrop fixed w-full top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <a href="/" class="logo-link flex items-center space-x-3">
                        <img src="https://i.ibb.co/Nd8Qrwmr/Untitled-design.png" alt="ListFast.ai Logo"
                            class="h-12 w-auto">
                        <span class="text-xl font-bold text-gray-900">ListFast.ai</span>
                    </a>
                </div>

                <div class="hidden lg:flex items-center space-x-1">
                    <a href="/"
                        class="nav-link text-gray-700 hover:text-gray-900 font-medium px-4 py-2 rounded-lg transition-colors">
                        Home
                    </a>
                    <a href="/features/"
                        class="nav-link text-gray-700 hover:text-gray-900 font-medium px-4 py-2 rounded-lg transition-colors">
                        Features
                    </a>
                    <a href="/about/"
                        class="nav-link text-gray-700 hover:text-gray-900 font-medium px-4 py-2 rounded-lg transition-colors">
                        About Us
                    </a>
                    <a href="/blogs/"
                        class="nav-link text-gray-700 hover:text-gray-900 font-medium px-4 py-2 rounded-lg transition-colors">
                        Blogs
                    </a>
                    <a href="/services/"
                        class="nav-link text-gray-700 hover:text-gray-900 font-medium px-4 py-2 rounded-lg transition-colors">
                        Services
                    </a>
                    <a href="/pricing/"
                        class="nav-link text-gray-700 hover:text-gray-900 font-medium px-4 py-2 rounded-lg transition-colors">
                        Pricing
                    </a>
                </div>

                <div class="hidden lg:flex items-center space-x-4">
                    <div id="nav-usage"
                        class="hidden items-center space-x-2 text-xs px-3 py-1 rounded-full bg-gray-100"></div>
                    <div class="relative">
                        <button id="profile-dropdown-btn"
                            class="flex items-center space-x-2 text-gray-700 px-3 py-2 rounded-lg font-medium hover:bg-gray-100 transition-colors">
                            <div
                                class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-semibold text-sm">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                </svg>
                            </div>
                            <svg class="w-4 h-4 transition-transform duration-200" id="dropdown-arrow" fill="none"
                                stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>

                        <div id="profile-dropdown"
                            class="profile-dropdown absolute right-0 mt-2 w-64 bg-white rounded-lg shadow-lg py-2 z-50 border border-gray-100">
                            <div class="px-4 py-3 border-b border-gray-100">
                                <div class="flex items-center space-x-3">
                                    <div
                                        class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-semibold">
                                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z">
                                            </path>
                                        </svg>
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <p class="text-sm font-medium text-gray-900 truncate" id="dropdown-user-email">
                                            Profile</p>
                                        <p class="text-xs text-gray-500">Account Settings</p>
                                    </div>
                                </div>
                            </div>

                            <div class="py-1">
                                <a href="/display-profile/"
                                    class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition-colors">
                                    <svg class="w-4 h-4 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z">
                                        </path>
                                    </svg>
                                    Profile Settings
                                </a>
                                <hr class="my-1">
                                <button id="logout-btn"
                                    class="flex items-center w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition-colors">
                                    <svg class="w-4 h-4 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1">
                                        </path>
                                    </svg>
                                    Sign Out
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="lg:hidden">
                    <button id="hamburger-btn" class="hamburger p-2 focus:outline-none">
                        <div class="hamburger-line"></div>
                        <div class="hamburger-line"></div>
                        <div class="hamburger-line"></div>
                    </button>
                </div>
            </div>

            <div id="mobile-menu" class="mobile-menu lg:hidden bg-white border-t border-gray-100">
                <div class="px-4 py-4 space-y-4">
                    <a href="/" class="block text-gray-700 hover:text-gray-900 font-medium py-2 transition-colors">
                        Home
                    </a>
                    <a href="/features/"
                        class="block text-gray-700 hover:text-gray-900 font-medium py-2 transition-colors">
                        Features
                    </a>
                    <a href="/about/"
                        class="block text-gray-700 hover:text-gray-900 font-medium py-2 transition-colors">
                        About Us
                    </a>
                    <a href="/blogs/"
                        class="block text-gray-700 hover:text-gray-900 font-medium py-2 transition-colors">
                        Blogs
                    </a>
                    <a href="/services/"
                        class="block text-gray-700 hover:text-gray-900 font-medium py-2 transition-colors">
                        Services
                    </a>
                    <a href="/pricing/"
                        class="block text-gray-700 hover:text-gray-900 font-medium py-2 transition-colors">
                        Pricing
                    </a>
                    <hr class="my-2">
                    <div id="mobile-nav-usage"
                        class="hidden text-xs px-3 py-2 rounded-lg bg-gray-100 text-gray-700 font-medium mb-2"></div>
                    <div class="flex items-center space-x-3 py-2">
                        <div
                            class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-semibold text-sm">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                        </div>
                        <span id="mobile-user-email" class="text-gray-600 text-sm font-medium"></span>
                    </div>
                    <a href="/display-profile/"
                        class="block text-gray-700 hover:text-gray-900 font-medium py-2 transition-colors">
                        Profile Settings
                    </a>
                    <button id="mobile-logout-btn"
                        class="w-full text-left text-red-600 hover:text-red-700 font-medium py-2 transition-colors">
                        Logout
                    </button>
                </div>
            </div>
        </div>
    </nav>


    <main class="pt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
            <div class="mb-8 sm:mb-12">
                <div class="max-w-4xl">
                    <h2 class="text-3xl sm:text-4xl md:text-5xl font-bold text-gray-900 mb-4">
                        Manage Your
                        <span class="hero-gradient bg-clip-text text-transparent">
                            Profile
                        </span>
                    </h2>
                    <p class="text-lg sm:text-xl text-gray-600 leading-relaxed">
                        Update your account information, manage listings, and customize your store settings.
                    </p>
                </div>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 sm:gap-6 mb-8 sm:mb-12">
                <div class="stat-card bg-gradient-to-br from-blue-500 to-blue-600 p-4 sm:p-6 rounded-2xl text-white">
                    <div class="text-2xl sm:text-3xl font-bold" id="total-listings-stat">-</div>
                    <div class="text-blue-100 text-sm font-medium">Total Listings</div>
                </div>
                <div class="stat-card bg-gradient-to-br from-green-500 to-green-600 p-4 sm:p-6 rounded-2xl text-white">
                    <div class="text-2xl sm:text-3xl font-bold" id="active-listings-stat">-</div>
                    <div class="text-green-100 text-sm font-medium">Active Listings</div>
                </div>
                <div
                    class="stat-card bg-gradient-to-br from-purple-500 to-purple-600 p-4 sm:p-6 rounded-2xl text-white">
                    <div class="text-2xl sm:text-3xl font-bold" id="inventory-value-stat">£-</div>
                    <div class="text-purple-100 text-sm font-medium">Inventory Value</div>
                </div>
            </div>

            <div class="card rounded-2xl shadow-xl p-4 sm:p-6 lg:p-8">
                <div class="grid lg:grid-cols-2 gap-6 sm:gap-8">
                    <div class="space-y-6">
                        <div class="bg-gray-50 p-4 sm:p-6 rounded-2xl">
                            <h4 class="font-semibold text-gray-900 mb-4 text-lg">Account Information</h4>
                            <div class="space-y-4">
                                <div class="flex items-center space-x-3 p-3 bg-white rounded-lg">
                                    <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                                        <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207">
                                            </path>
                                        </svg>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">Email Address</p>
                                        <p id="profile-email" class="font-semibold text-gray-900"></p>
                                    </div>
                                </div>

                                <div class="border-t border-gray-200 pt-4">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <div
                                                class="w-10 h-10 bg-gradient-to-r from-blue-100 to-purple-100 rounded-full flex items-center justify-center">
                                                <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                                                    </path>
                                                </svg>
                                            </div>
                                            <div>
                                                <h5 class="font-semibold text-gray-900">eBay Account</h5>
                                                <p class="text-sm text-gray-600">Switch to a different eBay account</p>
                                            </div>
                                        </div>
                                        <button id="reauthenticate-ebay-btn"
                                            class="bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-2 rounded-lg hover:from-blue-700 hover:to-purple-700 font-medium  transition-all duration-300 shadow-lg hover:shadow-xl text-sm">
                                            <svg class="inline w-4 h-4 mr-2" fill="none" stroke="currentColor"
                                                viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                                                </path>
                                            </svg>
                                            Change Account
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gray-50 p-4 sm:p-6 rounded-2xl">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="font-semibold text-gray-900 text-lg">Security</h4>
                                <button id="change-password-btn"
                                    class="text-blue-600 hover:text-blue-800 font-medium transition-colors px-3 py-1 rounded-lg hover:bg-blue-50">
                                    Change Password
                                </button>
                            </div>
                            <div id="password-display" class="flex items-center space-x-3 p-3 bg-white rounded-lg">
                                <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center">
                                    <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z">
                                        </path>
                                    </svg>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">Password</p>
                                    <p class="font-semibold text-gray-900">••••••••</p>
                                </div>
                            </div>

                            <div id="password-change-form" class="hidden">
                                <div id="request-otp-step">
                                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                                        <p class="text-sm text-blue-800">To change your password, we'll send a
                                            verification code to your email address.</p>
                                    </div>
                                    <div class="flex flex-col sm:flex-row gap-3">
                                        <button type="button" id="send-otp-btn"
                                            class="bg-blue-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-blue-700 disabled:bg-gray-400 ">
                                            Send Verification Code
                                        </button>
                                        <button type="button" id="cancel-password-change"
                                            class="bg-gray-200 text-gray-700 px-6 py-3 rounded-lg font-medium hover:bg-gray-300 ">
                                            Cancel
                                        </button>
                                    </div>
                                </div>

                                <div id="verify-otp-step" class="hidden">
                                    <form id="password-change-final-form" class="space-y-4">
                                        <div>
                                            <label class="block text-sm font-semibold text-gray-700 mb-3">Verification
                                                Code *</label>
                                            <input type="text" id="otp-input" required maxlength="6"
                                                placeholder="Enter 6-digit code"
                                                class="input-field w-full px-4 py-3 rounded-lg text-center text-lg font-mono">
                                            <p class="text-xs text-gray-500 mt-2">Check your email for the verification
                                                code</p>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-semibold text-gray-700 mb-3">New Password
                                                *</label>
                                            <input type="password" id="new-password" required minlength="6"
                                                class="input-field w-full px-4 py-3 rounded-lg">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-semibold text-gray-700 mb-3">Confirm New
                                                Password *</label>
                                            <input type="password" id="confirm-password" required minlength="6"
                                                class="input-field w-full px-4 py-3 rounded-lg">
                                        </div>
                                        <div class="flex flex-col sm:flex-row gap-3 pt-2">
                                            <button type="submit"
                                                class="bg-green-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-green-700 disabled:bg-gray-400 ">
                                                Update Password
                                            </button>
                                            <button type="button" id="back-to-otp-request"
                                                class="bg-gray-200 text-gray-700 px-6 py-3 rounded-lg font-medium hover:bg-gray-300 ">
                                                Back
                                            </button>
                                        </div>
                                    </form>
                                </div>
                                <div id="password-change-message" class="hidden mt-4 text-sm p-3 rounded-lg"></div>
                            </div>
                        </div>

                        <div class="bg-gray-50 p-4 sm:p-6 rounded-2xl">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="font-semibold text-gray-900 text-lg">Store Logo</h4>
                                <button id="edit-profile-pic-btn"
                                    class="text-blue-600 hover:text-blue-800 font-medium transition-colors px-3 py-1 rounded-lg hover:bg-blue-50">
                                    Change Picture
                                </button>
                            </div>
                            <div id="profile-pic-display" class="flex items-center space-x-4 p-3 bg-white rounded-lg">
                                <img id="profile-pic-modal" src="https://via.placeholder.com/80" alt="Profile Picture"
                                    class="profile-image w-16 h-16 sm:w-20 sm:h-20 rounded-full border-2 border-gray-200 object-cover">
                                <div>
                                    <p class="font-semibold text-gray-900">Store Logo</p>
                                    <p class="text-sm text-gray-600">Current store branding image</p>
                                </div>
                            </div>
                            <div id="profile-pic-edit-form" class="hidden">
                                <form id="profile-pic-form" class="space-y-4" enctype="multipart/form-data">
                                    <div>
                                        <label class="block text-sm font-semibold text-gray-700 mb-3">Upload Store
                                            Logo</label>
                                        <div class="flex items-center justify-center w-full">
                                            <label for="profile-pic-file"
                                                class="upload-area flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100">
                                                <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                                    <svg class="w-8 h-8 mb-4 text-gray-500" fill="none"
                                                        viewBox="0 0 20 16">
                                                        <path stroke="currentColor" stroke-linecap="round"
                                                            stroke-linejoin="round" stroke-width="2"
                                                            d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2" />
                                                    </svg>
                                                    <p class="mb-2 text-sm text-gray-500">
                                                        <span class="font-semibold">Click to upload</span> or drag and
                                                        drop
                                                    </p>
                                                    <p class="text-xs text-gray-500">PNG, JPG, GIF up to 10MB</p>
                                                </div>
                                                <input id="profile-pic-file" type="file" class="hidden"
                                                    accept="image/*" />
                                            </label>
                                        </div>
                                        <div id="image-preview" class="hidden mt-4 p-4 bg-white rounded-lg">
                                            <p class="text-sm font-semibold text-gray-700 mb-2">Preview:</p>
                                            <img id="preview-img" src="" alt="Preview"
                                                class="profile-image w-16 h-16 sm:w-20 sm:h-20 rounded-full border-2 border-gray-200 object-cover">
                                        </div>
                                        <p class="text-xs text-gray-500 mt-2">Upload a store logo (JPEG, PNG, GIF format
                                            supported)</p>
                                    </div>
                                    <div class="flex flex-col sm:flex-row gap-3 pt-2">
                                        <button type="submit"
                                            class="bg-blue-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-blue-700 disabled:bg-gray-400 ">
                                            Save Picture
                                        </button>
                                        <button type="button" id="cancel-profile-pic-edit"
                                            class="bg-gray-200 text-gray-700 px-6 py-3 rounded-lg font-medium hover:bg-gray-300 ">
                                            Cancel
                                        </button>
                                    </div>
                                </form>
                                <div id="profile-pic-update-message" class="hidden mt-4 text-sm p-3 rounded-lg"></div>
                            </div>
                        </div>

                        <div class="bg-gray-50 p-4 sm:p-6 rounded-2xl">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="font-semibold text-gray-900 text-lg">Warehouse Address</h4>
                                <button id="edit-address-btn"
                                    class="text-blue-600 hover:text-blue-800 font-medium transition-colors px-3 py-1 rounded-lg hover:bg-blue-50">
                                    Edit Address
                                </button>
                            </div>
                            <div id="address-display" class="p-3 bg-white rounded-lg">
                                <div class="flex items-start space-x-3">
                                    <div
                                        class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0">
                                        <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z">
                                            </path>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                        </svg>
                                    </div>
                                    <div class="text-gray-600 space-y-1">
                                        <p id="display-address-line1" class="font-semibold text-gray-900">-</p>
                                        <p><span id="display-city">-</span>, <span id="display-postal-code">-</span></p>
                                        <p id="display-country">-</p>
                                    </div>
                                </div>
                            </div>
                            <div id="address-edit-form" class="hidden">
                                <form id="address-form" class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-semibold text-gray-700 mb-3">Address Line 1
                                            *</label>
                                        <input type="text" id="edit-address-line1" required
                                            class="input-field w-full px-4 py-3 rounded-lg">
                                    </div>
                                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-semibold text-gray-700 mb-3">City *</label>
                                            <input type="text" id="edit-city" required
                                                class="input-field w-full px-4 py-3 rounded-lg">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-semibold text-gray-700 mb-3">Postal Code
                                                *</label>
                                            <input type="text" id="edit-postal-code" required
                                                class="input-field w-full px-4 py-3 rounded-lg">
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold text-gray-700 mb-3">Country</label>
                                        <select id="edit-country" disabled
                                            class="input-field w-full px-4 py-3 rounded-lg bg-gray-100">
                                            <option value="GB">United Kingdom</option>
                                        </select>
                                    </div>
                                    <div class="flex flex-col sm:flex-row gap-3 pt-2">
                                        <button type="submit"
                                            class="bg-blue-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-blue-700 disabled:bg-gray-400 ">
                                            Save Changes
                                        </button>
                                        <button type="button" id="cancel-address-edit"
                                            class="bg-gray-200 text-gray-700 px-6 py-3 rounded-lg font-medium hover:bg-gray-300 ">
                                            Cancel
                                        </button>
                                    </div>
                                </form>
                                <div id="address-update-message" class="hidden mt-4 text-sm p-3 rounded-lg"></div>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <div class="bg-gray-50 p-4 sm:p-6 rounded-2xl">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="font-semibold text-gray-900 text-lg">Recent Listings</h4>
                                <button id="view-all-listings"
                                    class="text-blue-600 hover:text-blue-800 font-medium transition-colors px-3 py-1 rounded-lg hover:bg-blue-50">
                                    View All →
                                </button>
                            </div>
                            <div id="recent-listings" class="space-y-3 max-h-80 overflow-y-auto">
                                <div class="text-center text-gray-500 py-8">
                                    <div
                                        class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-3">
                                    </div>
                                    Loading listings...
                                </div>
                            </div>
                        </div>

                        <div id="all-listings-view" class="hidden bg-gray-50 p-4 sm:p-6 rounded-2xl">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="font-semibold text-gray-900 text-lg">All Listings</h4>
                                <button id="back-to-recent"
                                    class="text-blue-600 hover:text-blue-800 font-medium transition-colors px-3 py-1 rounded-lg hover:bg-blue-50">
                                    ← Back to Recent
                                </button>
                            </div>
                            <div id="all-listings" class="space-y-3 max-h-80 overflow-y-auto"></div>
                            <div class="mt-4 flex justify-center">
                                <button id="load-more-listings"
                                    class="hidden bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 font-medium ">
                                    Load More
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gray-50 p-4 sm:p-6 rounded-2xl">
                        <h4 class="font-semibold text-gray-900 text-lg mb-4">Subscription & Billing</h4>
                        <div id="plan-details" class="p-3 bg-white rounded-lg">
                            <p class="text-center text-gray-500">Loading plan details...</p>
                        </div>
                        <div id="refund-message" class="hidden mt-4 text-sm p-3 rounded-lg"></div>
                    </div>

                    <div class="bg-gray-50 p-4 sm:p-6 rounded-2xl">
                        <h4 class="font-semibold text-gray-900 text-lg mb-4">Order History</h4>
                        <div id="order-history" class="space-y-3">
                            <div class="text-center text-gray-500 py-4">
                                <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto mb-2"></div>
                                Loading orders...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-gray-900 text-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="space-y-4">
                    <h3 class="text-xl sm:text-2xl font-bold">ListFast.ai</h3>
                    <p class="text-gray-400 text-sm leading-relaxed">
                        Streamline your eBay listings with AI-powered tools for image enhancement, single items,
                        multipacks, and bundles.
                    </p>
                    <div class="flex space-x-4 pt-4">
                        <a href="#" class="text-gray-400 hover:text-white transition-colors">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path
                                    d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.15z">
                                </path>
                            </svg>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition-colors">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path
                                    d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-2.596 0-4.194 1.722-4.194 4.6v3.4z">
                                </path>
                            </svg>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition-colors">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 16 16">
                                <path
                                    d="M8 0C5.829 0 5.556.01 4.703.048 3.85.088 3.269.222 2.76.42a3.9 3.9 0 0 0-1.417.923A3.9 3.9 0 0 0 .42 2.76C.222 3.268.087 3.85.048 4.7.01 5.555 0 5.827 0 8.001c0 2.172.01 2.444.048 3.297.04.852.174 1.433.372 1.942.205.526.478.972.923 1.417.444.445.89.719 1.416.923.51.198 1.09.333 1.942.372C5.555 15.99 5.827 16 8 16s2.444-.01 3.298-.048c.851-.04 1.434-.174 1.943-.372a3.9 3.9 0 0 0 1.416-.923c.445-.445.718-.891.923-1.417.197-.509.332-1.09.372-1.942C15.99 10.445 16 10.173 16 8s-.01-2.445-.048-3.299c-.04-.851-.175-1.433-.372-1.941a3.9 3.9 0 0 0-.923-1.417A3.9 3.9 0 0 0 13.24.42c-.51-.198-1.092-.333-1.943-.372C10.443.01 10.172 0 7.998 0zm-.717 1.442h.718c2.136 0 2.389.007 3.232.046.78.035 1.204.166 1.486.275.373.145.64.319.92.599s.453.546.598.92c.11.281.24.705.275 1.485.039.843.047 1.096.047 3.231s-.008 2.389-.047 3.232c-.035.78-.166 1.203-.275 1.485a2.5 2.5 0 0 1-.599.919c-.28.28-.546.453-.92.598-.28.11-.704.24-1.485.276-.843.038-1.096.047-3.232.047s-2.39-.009-3.233-.047c-.78-.036-1.203-.166-1.485-.276a2.5 2.5 0 0 1-.92-.598 2.5 2.5 0 0 1-.6-.92c-.109-.281-.24-.705-.275-1.485-.038-.843-.046-1.096-.046-3.233s.008-2.388.046-3.231c.036-.78.166-1.204.276-1.486.145-.373.319-.64.599-.92s.546-.453.92-.598c.282-.11.705-.24 1.485-.276.738-.034 1.024-.044 2.515-.045zm4.988 1.328a.96.96 0 1 0 0 1.92.96.96 0 0 0 0-1.92m-4.27 1.122a4.109 4.109 0 1 0 0 8.217 4.109 4.109 0 0 0 0-8.217m0 1.441a2.667 2.667 0 1 1 0 5.334 2.667 2.667 0 0 1 0-5.334">
                                </path>
                            </svg>
                        </a>
                    </div>
                </div>

                <div>
                    <h4 class="text-base sm:text-lg font-semibold mb-4">Quick Links</h4>
                    <ul class="space-y-3 text-gray-400 text-sm">
                        <li><a href="/contact/" class="hover:text-white transition-colors flex items-center">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z">
                                    </path>
                                </svg>
                                Contact Us
                            </a></li>
                        <li><a href="/legal/" class="hover:text-white transition-colors flex items-center">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                Legal & Compliance Pages
                            </a></li>
                        <li><a href="/faq/" class="hover:text-white transition-colors flex items-center">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z">
                                    </path>
                                </svg>
                                FAQ/Help Center
                            </a></li>
                    </ul>
                </div>

                <div>
                    <h4 class="text-base sm:text-lg font-semibold mb-4">Stay Updated</h4>
                    <p class="text-gray-400 text-sm mb-4">Get the latest updates and AI listing tips.</p>
                    <form class="space-y-3">
                        <input type="email" placeholder="Enter your email"
                            class="w-full px-4 py-3 rounded-lg bg-gray-800 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm border border-gray-700 focus:border-blue-500 transition-colors">
                        <button type="submit"
                            class="w-full hero-gradient px-4 py-3 rounded-lg font-semibold hover:opacity-90 transition-opacity text-sm">
                            Subscribe Now
                        </button>
                    </form>
                </div>
            </div>

            <div
                class="mt-8 pt-6 border-t border-gray-800 flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0">
                <p class="text-gray-400 text-sm">&copy; <span id="year"></span> ListFast.ai. All rights reserved.</p>
                <p class="text-gray-400 text-sm">Powered by AI • Made with ❤️</p>
            </div>
        </div>
    </footer>

    <script>
        let currentUserProfile = null;
        let currentListingsPage = 1;
        let hasMoreListings = false;

        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const response = await fetch('/api/auth-status/');
                const data = await response.json();
                if (!data.is_logged_in) {
                    window.location.href = '/login/';
                    return;
                } else if (!data.has_profile) {
                    window.location.href = '/profile/';
                    return;
                } else if (!data.has_ebay_auth) {
                    window.location.href = '/ebay-auth/';
                    return;
                }
                document.getElementById('dropdown-user-email').textContent = data.email;
                document.getElementById('mobile-user-email').textContent = data.email;
                await loadProfileData();
                await loadPlanStatus();
                await loadOrderHistory();
            } catch (error) {
                window.location.href = '/login/';
            }
        });

        const hamburgerBtn = document.getElementById('hamburger-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        const profileDropdownBtn = document.getElementById('profile-dropdown-btn');
        const profileDropdown = document.getElementById('profile-dropdown');
        const dropdownArrow = document.getElementById('dropdown-arrow');

        hamburgerBtn.addEventListener('click', () => {
            hamburgerBtn.classList.toggle('open');
            mobileMenu.classList.toggle('active');
        });

        profileDropdownBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            const isActive = profileDropdown.classList.contains('active');
            profileDropdown.classList.toggle('active');

            if (dropdownArrow) {
                dropdownArrow.style.transform = isActive ? 'rotate(0deg)' : 'rotate(180deg)';
            }
        });

        document.addEventListener('click', (e) => {
            if (!profileDropdown.contains(e.target) && !profileDropdownBtn.contains(e.target)) {
                profileDropdown.classList.remove('active');
                if (dropdownArrow) {
                    dropdownArrow.style.transform = 'rotate(0deg)';
                }
            }
        });

        document.getElementById('logout-btn').addEventListener('click', async () => {
            try {
                const getCookie = (name) => {
                    let cookieValue = null;
                    if (document.cookie && document.cookie !== '') {
                        const cookies = document.cookie.split(';');
                        for (let i = 0; i < cookies.length; i++) {
                            const cookie = cookies[i].trim();
                            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                break;
                            }
                        }
                    }
                    return cookieValue;
                };
                const csrftoken = getCookie('csrftoken');
                await fetch('/logout/', { method: 'POST', headers: { 'X-CSRFToken': csrftoken } });
                window.location.href = '/';
            } catch (error) {
                console.error('Logout failed:', error);
            }
        });

        document.getElementById('mobile-logout-btn').addEventListener('click', async () => {
            try {
                const getCookie = (name) => {
                    let cookieValue = null;
                    if (document.cookie && document.cookie !== '') {
                        const cookies = document.cookie.split(';');
                        for (let i = 0; i < cookies.length; i++) {
                            const cookie = cookies[i].trim();
                            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                break;
                            }
                        }
                    }
                    return cookieValue;
                };
                const csrftoken = getCookie('csrftoken');
                await fetch('/logout/', { method: 'POST', headers: { 'X-CSRFToken': csrftoken } });
                window.location.href = '/';
            } catch (error) {
                console.error('Logout failed:', error);
            }
        });

        async function loadProfileData() {
            try {
                const [statsResponse, profileResponse] = await Promise.all([
                    fetch('/api/user-stats/'),
                    fetch('/api/fetch-address-imageprofile/')
                ]);

                if (statsResponse.ok) {
                    const statsData = await statsResponse.json();
                    document.getElementById('total-listings-stat').textContent = statsData.total_listings;
                    document.getElementById('active-listings-stat').textContent = statsData.active_listings;
                    document.getElementById('inventory-value-stat').textContent = `£${statsData.total_inventory_value.toFixed(2)}`;
                    document.getElementById('profile-email').textContent = statsData.email;
                    if (statsData.usage && statsData.usage.plan) {
                        const el = document.getElementById('nav-usage');
                        el.classList.remove('hidden');
                        el.classList.add('flex');
                        el.textContent = `Plan: ${statsData.usage.plan} • ${statsData.usage.used}/${statsData.usage.quota} (${statsData.usage.credits_left} cr)`;
                        
                        const mobileEl = document.getElementById('mobile-nav-usage');
                        mobileEl.classList.remove('hidden');
                        mobileEl.classList.add('block');
                        mobileEl.textContent = `Plan: ${statsData.usage.plan} • ${statsData.usage.used}/${statsData.usage.quota} (${statsData.usage.credits_left} cr)`;
                    }
                }

                if (profileResponse.ok) {
                    const profileData = await profileResponse.json();
                    currentUserProfile = profileData;
                    displayAddress(profileData);
                    if (profileData.profile_pic_url) {
                        document.getElementById('user-profile-pic').src = profileData.profile_pic_url;
                        document.getElementById('mobile-user-profile-pic').src = profileData.profile_pic_url;
                    }
                } else {
                    displayAddress(null);
                }

                loadRecentListings();
            } catch (error) {
                console.error('Error loading profile data:', error);
            }
        }

        async function loadUserProfile() {
            try {
                const response = await fetch('/api/fetch-address-imageprofile/');
                const data = await response.json();
                if (response.ok && data) {
                    currentUserProfile = data;
                    displayAddress(data);
                } else {
                    displayAddress(null);
                }
            } catch (error) {
                console.error('Error loading user profile:', error);
                displayAddress(null);
            }
        }

        function displayAddress(profile) {
            if (profile) {
                document.getElementById('display-address-line1').textContent = profile.address_line1;
                document.getElementById('display-city').textContent = profile.city;
                document.getElementById('display-postal-code').textContent = profile.postal_code;
                document.getElementById('display-country').textContent = profile.country === 'GB' ? 'United Kingdom' : profile.country;
                const profilePicUrl = profile.profile_pic_url || 'https://via.placeholder.com/80';
                document.getElementById('profile-pic-modal').src = profilePicUrl;
            } else {
                document.getElementById('display-address-line1').textContent = 'No address set';
                document.getElementById('display-city').textContent = '-';
                document.getElementById('display-postal-code').textContent = '-';
                document.getElementById('display-country').textContent = '-';
                document.getElementById('profile-pic-modal').src = 'https://via.placeholder.com/80';
            }
        }

        document.getElementById('change-password-btn').addEventListener('click', () => {
            showPasswordChangeForm();
        });

        document.getElementById('cancel-password-change').addEventListener('click', () => {
            resetPasswordChangeForm();
        });

        document.getElementById('back-to-otp-request').addEventListener('click', () => {
            showOtpRequestStep();
        });

        function showPasswordChangeForm() {
            document.getElementById('password-display').classList.add('hidden');
            document.getElementById('password-change-form').classList.remove('hidden');
            document.getElementById('change-password-btn').classList.add('hidden');
            showOtpRequestStep();
        }

        function resetPasswordChangeForm() {
            document.getElementById('password-change-form').classList.add('hidden');
            document.getElementById('password-display').classList.remove('hidden');
            document.getElementById('change-password-btn').classList.remove('hidden');

            document.getElementById('otp-input').value = '';
            document.getElementById('new-password').value = '';
            document.getElementById('confirm-password').value = '';

            const messageEl = document.getElementById('password-change-message');
            messageEl.classList.add('hidden');
            messageEl.textContent = '';

            showOtpRequestStep();
        }

        function showOtpRequestStep() {
            document.getElementById('request-otp-step').classList.remove('hidden');
            document.getElementById('verify-otp-step').classList.add('hidden');
        }

        function showVerifyOtpStep() {
            document.getElementById('request-otp-step').classList.add('hidden');
            document.getElementById('verify-otp-step').classList.remove('hidden');
        }

        document.getElementById('send-otp-btn').addEventListener('click', async () => {
            const sendButton = document.getElementById('send-otp-btn');
            const originalText = sendButton.textContent;
            sendButton.disabled = true;
            sendButton.textContent = 'Sending...';

            try {
                const getCookie = (name) => {
                    let cookieValue = null;
                    if (document.cookie && document.cookie !== '') {
                        const cookies = document.cookie.split(';');
                        for (let i = 0; i < cookies.length; i++) {
                            const cookie = cookies[i].trim();
                            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                break;
                            }
                        }
                    }
                    return cookieValue;
                };
                const csrftoken = getCookie('csrftoken');
                const response = await fetch('/api/send-password-otp/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'X-CSRFToken': csrftoken }
                });

                const data = await response.json();

                if (response.ok) {
                    showPasswordChangeMessage('Verification code sent to your email. Please check your inbox.', 'success');
                    showVerifyOtpStep();
                } else {
                    showPasswordChangeMessage(data.error || 'Failed to send verification code.', 'error');
                }
            } catch (error) {
                showPasswordChangeMessage('Network error. Please try again.', 'error');
            }

            sendButton.disabled = false;
            sendButton.textContent = originalText;
        });

        document.getElementById('password-change-final-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const otp = document.getElementById('otp-input').value.trim();
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;

            if (!otp || otp.length !== 6) {
                showPasswordChangeMessage('Please enter a valid 6-digit verification code.', 'error');
                return;
            }

            if (newPassword.length < 6) {
                showPasswordChangeMessage('Password must be at least 6 characters long.', 'error');
                return;
            }

            if (newPassword !== confirmPassword) {
                showPasswordChangeMessage('Passwords do not match.', 'error');
                return;
            }

            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.disabled = true;
            submitBtn.textContent = 'Updating...';

            try {
                const getCookie = (name) => {
                    let cookieValue = null;
                    if (document.cookie && document.cookie !== '') {
                        const cookies = document.cookie.split(';');
                        for (let i = 0; i < cookies.length; i++) {
                            const cookie = cookies[i].trim();
                            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                break;
                            }
                        }
                    }
                    return cookieValue;
                };
                const csrftoken = getCookie('csrftoken');
                const response = await fetch('/api/change-password/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'X-CSRFToken': csrftoken },
                    body: JSON.stringify({
                        otp: otp,
                        new_password: newPassword
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    showPasswordChangeMessage('Password updated successfully!', 'success');
                    setTimeout(() => {
                        resetPasswordChangeForm();
                    }, 2000);
                } else {
                    showPasswordChangeMessage(data.error || 'Failed to update password.', 'error');
                }
            } catch (error) {
                showPasswordChangeMessage('Network error. Please try again.', 'error');
            }

            submitBtn.disabled = false;
            submitBtn.textContent = originalText;
        });

        function showPasswordChangeMessage(message, type) {
            const messageEl = document.getElementById('password-change-message');
            messageEl.textContent = message;
            messageEl.className = `mt-4 text-sm p-3 rounded-lg ${type === 'success' ? 'text-green-800 bg-green-50 border border-green-200' : 'text-red-800 bg-red-50 border border-red-200'}`;
            messageEl.classList.remove('hidden');
        }

        document.getElementById('edit-address-btn').addEventListener('click', () => { showAddressEditForm(); });
        document.getElementById('cancel-address-edit').addEventListener('click', () => { resetAddressForm(); });

        function showAddressEditForm() {
            if (currentUserProfile) {
                document.getElementById('edit-address-line1').value = currentUserProfile.address_line1 || '';
                document.getElementById('edit-city').value = currentUserProfile.city || '';
                document.getElementById('edit-postal-code').value = currentUserProfile.postal_code || '';
                document.getElementById('edit-country').value = currentUserProfile.country || 'GB';
            }
            document.getElementById('address-display').classList.add('hidden');
            document.getElementById('address-edit-form').classList.remove('hidden');
            document.getElementById('edit-address-btn').classList.add('hidden');
        }

        function resetAddressForm() {
            document.getElementById('address-edit-form').classList.add('hidden');
            document.getElementById('address-display').classList.remove('hidden');
            document.getElementById('edit-address-btn').classList.remove('hidden');
            const messageEl = document.getElementById('address-update-message');
            messageEl.classList.add('hidden');
            messageEl.textContent = '';
        }

        document.getElementById('address-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = {
                address_line1: document.getElementById('edit-address-line1').value.trim(),
                city: document.getElementById('edit-city').value.trim(),
                postal_code: document.getElementById('edit-postal-code').value.trim().toUpperCase(),
                country: document.getElementById('edit-country').value
            };
            if (!formData.address_line1 || !formData.city || !formData.postal_code) {
                showAddressMessage('Please fill in all required fields.', 'error'); return;
            }
            try {
                const getCookie = (name) => {
                    let cookieValue = null;
                    if (document.cookie && document.cookie !== '') {
                        const cookies = document.cookie.split(';');
                        for (let i = 0; i < cookies.length; i++) {
                            const cookie = cookies[i].trim();
                            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                break;
                            }
                        }
                    }
                    return cookieValue;
                };
                const csrftoken = getCookie('csrftoken');
                const response = await fetch('/api/profile/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'X-CSRFToken': csrftoken },
                    body: JSON.stringify(formData),
                });
                const data = await response.json();
                if (response.ok) {
                    showAddressMessage('Address updated successfully!', 'success');
                    currentUserProfile = { ...currentUserProfile, ...formData };
                    displayAddress(currentUserProfile);
                    setTimeout(() => { resetAddressForm(); }, 1500);
                } else {
                    showAddressMessage(data.error || 'Failed to update address.', 'error');
                }
            } catch (error) {
                showAddressMessage('Network error. Please try again.', 'error');
            }
        });

        function showAddressMessage(message, type) {
            const messageEl = document.getElementById('address-update-message');
            messageEl.textContent = message;
            messageEl.className = `mt-4 text-sm p-3 rounded-lg ${type === 'success' ? 'text-green-800 bg-green-50 border border-green-200' : 'text-red-800 bg-red-50 border border-red-200'}`;
            messageEl.classList.remove('hidden');
        }

        document.getElementById('edit-profile-pic-btn').addEventListener('click', () => {
            showProfilePicEditForm();
        });
        document.getElementById('cancel-profile-pic-edit').addEventListener('click', () => {
            resetProfilePicForm();
        });
        document.getElementById('profile-pic-file').addEventListener('change', function (e) {
            const file = e.target.files[0];
            if (file) {
                if (!file.type.startsWith('image/')) {
                    showProfilePicMessage('Please select a valid image file.', 'error'); return;
                }
                if (file.size > 10 * 1024 * 1024) {
                    showProfilePicMessage('File size must be less than 10MB.', 'error'); return;
                }
                const reader = new FileReader();
                reader.onload = function (e) {
                    document.getElementById('preview-img').src = e.target.result;
                    document.getElementById('image-preview').classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        });
        function showProfilePicEditForm() {
            document.getElementById('profile-pic-display').classList.add('hidden');
            document.getElementById('profile-pic-edit-form').classList.remove('hidden');
            document.getElementById('edit-profile-pic-btn').classList.add('hidden');
            document.getElementById('profile-pic-file').value = '';
            document.getElementById('image-preview').classList.add('hidden');
        }
        function resetProfilePicForm() {
            document.getElementById('profile-pic-edit-form').classList.add('hidden');
            document.getElementById('profile-pic-display').classList.remove('hidden');
            document.getElementById('edit-profile-pic-btn').classList.remove('hidden');
            document.getElementById('profile-pic-file').value = '';
            document.getElementById('image-preview').classList.add('hidden');
            const messageEl = document.getElementById('profile-pic-update-message');
            messageEl.classList.add('hidden');
            messageEl.textContent = '';
        }
        document.getElementById('profile-pic-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const fileInput = document.getElementById('profile-pic-file');
            const file = fileInput.files[0];
            if (!file) {
                showProfilePicMessage('Please select an image file.', 'error'); return;
            }
            if (!file.type.startsWith('image/')) {
                showProfilePicMessage('Please select a valid image file.', 'error'); return;
            }
            if (file.size > 10 * 1024 * 1024) {
                showProfilePicMessage('File size must be less than 10MB.', 'error'); return;
            }
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.disabled = true;
            submitBtn.textContent = 'Uploading...';
            try {
                const getCookie = (name) => {
                    let cookieValue = null;
                    if (document.cookie && document.cookie !== '') {
                        const cookies = document.cookie.split(';');
                        for (let i = 0; i < cookies.length; i++) {
                            const cookie = cookies[i].trim();
                            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                break;
                            }
                        }
                    }
                    return cookieValue;
                };
                const csrftoken = getCookie('csrftoken');
                const formData = new FormData();
                formData.append('image', file);
                const response = await fetch('/api/upload-profile-image/', {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-CSRFToken': csrftoken
                    }
                });
                const data = await response.json();
                if (response.ok && data.status === 'success') {
                    const profileResponse = await fetch('/api/profile/', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json', 'X-CSRFToken': csrftoken },
                        body: JSON.stringify({
                            ...currentUserProfile,
                            profile_pic_url: data.image_url
                        }),
                    });
                    const profileData = await profileResponse.json();
                    if (profileResponse.ok) {
                        showProfilePicMessage('Profile picture updated successfully!', 'success');
                        currentUserProfile = { ...currentUserProfile, profile_pic_url: data.image_url };
                        displayAddress(currentUserProfile);
                        document.getElementById('user-profile-pic').src = data.image_url;
                        document.getElementById('mobile-user-profile-pic').src = data.image_url;
                        setTimeout(() => { resetProfilePicForm(); }, 1500);
                    } else {
                        showProfilePicMessage(profileData.error || 'Failed to update profile picture.', 'error');
                    }
                } else {
                    showProfilePicMessage(data.error || 'Failed to upload image.', 'error');
                }
            } catch (error) {
                console.error('Upload error:', error);
                showProfilePicMessage('Network error. Please try again.', 'error');
            }
            submitBtn.disabled = false;
            submitBtn.textContent = originalText;
        });
        function showProfilePicMessage(message, type) {
            const messageEl = document.getElementById('profile-pic-update-message');
            messageEl.textContent = message;
            messageEl.className = `mt-4 text-sm p-3 rounded-lg ${type === 'success' ? 'text-green-800 bg-green-50 border border-green-200' : 'text-red-800 bg-red-50 border border-red-200'}`;
            messageEl.classList.remove('hidden');
        }

        async function loadRecentListings() {
            try {
                const response = await fetch('/api/my-listings/?page=1');
                const data = await response.json();
                const container = document.getElementById('recent-listings');
                if (response.ok && data.listings.length > 0) {
                    container.innerHTML = data.listings.slice(0, 5).map(listing => `
                    <div class="listing-card flex items-center justify-between p-4 rounded-xl">
                        <div class="flex-1">
                            <h5 class="font-semibold text-gray-900 text-sm">${listing.title}</h5>
                            <p class="text-xs text-gray-500 mt-1">
                                ${listing.category_name || 'Unknown Category'} • 
                                £${listing.price_value} • 
                                Qty: ${listing.quantity}
                            </p>
                        </div>
                        ${listing.view_url ? `
                            <a href="${listing.view_url}" target="_blank" class="text-blue-600 hover:text-blue-800 text-xs font-medium transition-colors px-3 py-1 rounded-lg hover:bg-blue-50">
                                View →
                            </a>
                        ` : ''}
                    </div>
                `).join('');
                } else {
                    container.innerHTML = '<div class="text-center text-gray-500 py-8">No listings found</div>';
                }
            } catch (error) {
                document.getElementById('recent-listings').innerHTML =
                    '<div class="text-center text-red-500 py-8">Error loading listings</div>';
            }
        }

        document.getElementById('view-all-listings').addEventListener('click', async () => {
            document.getElementById('recent-listings').closest('div').classList.add('hidden');
            document.getElementById('all-listings-view').classList.remove('hidden');
            await loadAllListings();
        });

        document.getElementById('back-to-recent').addEventListener('click', () => {
            document.getElementById('all-listings-view').classList.add('hidden');
            document.getElementById('recent-listings').closest('div').classList.remove('hidden');
        });

        async function loadAllListings(page = 1) {
            try {
                const response = await fetch(`/api/my-listings/?page=${page}`);
                const data = await response.json();
                const container = document.getElementById('all-listings');
                if (response.ok) {
                    if (page === 1) {
                        container.innerHTML = '';
                    }
                    if (data.listings.length > 0) {
                        container.innerHTML += data.listings.map(listing => `
                        <div class="listing-card flex items-center justify-between p-4 rounded-xl">
                            <div class="flex-1">
                                <h5 class="font-semibold text-gray-900 text-sm">${listing.title}</h5>
                                <p class="text-xs text-gray-500 mt-1">
                                    ${listing.category_name || 'Unknown Category'} • 
                                    £${listing.price_value} • 
                                    Qty: ${listing.quantity} •
                                    ${new Date(listing.created_at).toLocaleDateString()}
                                </p>
                            </div>
                            <div class="flex items-center space-x-3">
                                <span class="px-3 py-1 text-xs rounded-full font-medium ${listing.status === 'ACTIVE' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}">
                                    ${listing.status}
                                </span>
                                ${listing.view_url ? `
                                    <a href="${listing.view_url}" target="_blank" class="text-blue-600 hover:text-blue-800 text-xs font-medium transition-colors px-3 py-1 rounded-lg hover:bg-blue-50">
                                        View →
                                    </a>
                                ` : ''}
                            </div>
                        </div>
                    `).join('');
                    } else if (page === 1) {
                        container.innerHTML = '<div class="text-center text-gray-500 py-8">No listings found</div>';
                    }
                    hasMoreListings = data.has_more;
                    currentListingsPage = page;
                    const loadMoreBtn = document.getElementById('load-more-listings');
                    if (hasMoreListings) {
                        loadMoreBtn.classList.remove('hidden');
                    } else {
                        loadMoreBtn.classList.add('hidden');
                    }
                }
            } catch (error) {
                console.error('Error loading listings:', error);
            }
        }
        document.getElementById('load-more-listings').addEventListener('click', () => {
            loadAllListings(currentListingsPage + 1);
        });
        document.getElementById('reauthenticate-ebay-btn').addEventListener('click', async () => {
            const button = document.getElementById('reauthenticate-ebay-btn');
            const originalText = button.innerHTML;

            button.innerHTML = `
        <svg class="inline w-4 h-4 mr-2 animate-spin" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        Switching Account...
    `;
            button.disabled = true;

            try {
                const getCookie = (name) => {
                    let cookieValue = null;
                    if (document.cookie && document.cookie !== '') {
                        const cookies = document.cookie.split(';');
                        for (let i = 0; i < cookies.length; i++) {
                            const cookie = cookies[i].trim();
                            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                break;
                            }
                        }
                    }
                    return cookieValue;
                };
                const csrftoken = getCookie('csrftoken');
                const response = await fetch('/api/revoke-ebay-auth/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrftoken
                    }
                });
                const data = await response.json();
                if (response.ok) {
                    button.innerHTML = `
                <svg class="inline w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                Redirecting...
            `;
                    setTimeout(() => {
                        window.location.href = '/ebay-auth/';
                    }, 1000);
                } else {
                    throw new Error(data.error || 'Failed to switch eBay account');
                }
            } catch (error) {
                console.error('Error switching eBay account:', error);
                button.innerHTML = `
            <svg class="inline w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
            </svg>
            Error - Try Again
        `;
                button.classList.add('from-red-600', 'to-red-700', 'hover:from-red-700', 'hover:to-red-800');
                button.classList.remove('from-blue-600', 'to-purple-600', 'hover:from-blue-700', 'hover:to-purple-700');

                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.disabled = false;
                    button.classList.remove('from-red-600', 'to-red-700', 'hover:from-red-700', 'hover:to-red-800');
                    button.classList.add('from-blue-600', 'to-purple-600', 'hover:from-blue-700', 'hover:to-purple-700');
                }, 3000);
            }
        });

        async function loadPlanStatus() {
            try {
                const response = await fetch('/api/plan-status/');
                const data = await response.json();
                const container = document.getElementById('plan-details');

                if (response.ok) {
                    let html = `
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">Current Plan</p>
                                <p class="font-semibold text-gray-900">${data.plan_name}</p>
                            </div>
                    `;

                    if (data.has_pending_refund) {
                        html += `
                            <button disabled class="bg-yellow-600 text-white px-4 py-2 rounded-lg font-medium cursor-not-allowed text-sm opacity-75">
                                Refund Requested
                            </button>
                        `;
                    } else if (data.is_refundable) {
                        html += `
                            <button id="request-refund-btn" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 font-medium transition-all duration-300 shadow-lg hover:shadow-xl text-sm">
                                Request Refund
                            </button>
                        `;
                    } else if (data.plan_name !== 'Free Plan') {
                         html += `
                            <p class="text-sm text-gray-500">Not refundable</p>
                        `;
                    }
                    
                    html += `</div>`;
                    if (data.period_end) {
                         html += `<p class="text-xs text-gray-500 mt-2">Renews on: ${new Date(data.period_end).toLocaleDateString()}</p>`;
                    }
                    if (data.has_pending_refund && data.refund_requested_at) {
                        html += `<p class="text-xs text-yellow-600 mt-2">⏳ Refund requested on ${new Date(data.refund_requested_at).toLocaleDateString()} - Under review</p>`;
                    }
                    if (data.has_completed_refund && data.refund_completed_at) {
                        html += `<p class="text-xs text-green-600 mt-2">✅ Refund completed on ${new Date(data.refund_completed_at).toLocaleDateString()} - We have completed the refund from our end. It may take 1-2 business days to reflect in your bank.</p>`;
                    }

                    container.innerHTML = html;
                    
                    if (data.is_refundable && !data.has_pending_refund) {
                        document.getElementById('request-refund-btn').addEventListener('click', handleRefundRequest);
                    }
                } else {
                    container.innerHTML = '<p class="text-center text-red-500">Could not load plan details.</p>';
                }
            } catch (error) {
                document.getElementById('plan-details').innerHTML = '<p class="text-center text-red-500">Error loading plan details.</p>';
            }
        }

        async function loadOrderHistory() {
            try {
                const response = await fetch('/api/order-history/');
                const data = await response.json();
                const container = document.getElementById('order-history');

                if (response.ok && data.orders && data.orders.length > 0) {
                    container.innerHTML = data.orders.map(order => {
                        const statusColor = {
                            'completed': 'bg-green-100 text-green-800',
                            'refunded': 'bg-yellow-100 text-yellow-800',
                            'pending': 'bg-blue-100 text-blue-800',
                            'failed': 'bg-red-100 text-red-800'
                        }[order.status] || 'bg-gray-100 text-gray-800';

                        return `
                            <div class="bg-white p-4 rounded-lg border border-gray-200">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <p class="font-semibold text-gray-900">${order.description}</p>
                                        <p class="text-xs text-gray-500 mt-1">${new Date(order.created_at).toLocaleString()}</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-bold text-gray-900">£${order.amount.toFixed(2)}</p>
                                        <span class="inline-block px-2 py-1 text-xs font-medium rounded-full ${statusColor} mt-1">
                                            ${order.status.charAt(0).toUpperCase() + order.status.slice(1)}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                } else {
                    container.innerHTML = '<p class="text-center text-gray-500 py-8">No orders found</p>';
                }
            } catch (error) {
                document.getElementById('order-history').innerHTML = '<p class="text-center text-red-500 py-4">Error loading order history</p>';
            }
        }

        async function handleRefundRequest() {
            if (!confirm('Are you sure you want to request a refund? Our team will review your request within 2-3 business days. You can continue using your plan until the refund is processed.')) {
                return;
            }

            const refundBtn = document.getElementById('request-refund-btn');
            refundBtn.disabled = true;
            refundBtn.textContent = 'Submitting...';

            try {
                const getCookie = (name) => {
                    let cookieValue = null;
                    if (document.cookie && document.cookie !== '') {
                        const cookies = document.cookie.split(';');
                        for (let i = 0; i < cookies.length; i++) {
                            const cookie = cookies[i].trim();
                            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                break;
                            }
                        }
                    }
                    return cookieValue;
                };
                const csrftoken = getCookie('csrftoken');
                const response = await fetch('/api/request-refund/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'X-CSRFToken': csrftoken },
                });
                const data = await response.json();

                if (response.ok) {
                    showRefundMessage(data.message || 'Refund request submitted successfully! Our team will review and process it within 2-3 business days. You will receive an email confirmation.', 'success');
                    loadPlanStatus(); // Reload to show "Refund Requested" status
                } else {
                    showRefundMessage(data.error || 'Refund request failed.', 'error');
                    refundBtn.disabled = false;
                    refundBtn.textContent = 'Request Refund';
                }
            } catch (error) {
                showRefundMessage('A network error occurred. Please try again.', 'error');
                refundBtn.disabled = false;
                refundBtn.textContent = 'Request Refund';
            }
        }

        function showRefundMessage(message, type) {
            const messageEl = document.getElementById('refund-message');
            messageEl.textContent = message;
            messageEl.className = `mt-4 text-sm p-3 rounded-lg ${type === 'success' ? 'text-green-800 bg-green-50 border border-green-200' : 'text-red-800 bg-red-50 border border-red-200'}`;
            messageEl.classList.remove('hidden');
        }

        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        document.getElementById('year').textContent = new Date().getFullYear();

        async function handleSubscription(event) {
            event.preventDefault();
            const form = event.target;
            const emailInput = form.querySelector('input[type="email"]');
            const email = emailInput.value;
            const submitBtn = form.querySelector('button[type="submit"]');

            const originalBtnText = submitBtn.textContent;
            submitBtn.disabled = true;
            submitBtn.textContent = 'Subscribing...';

            try {
                const response = await fetch('/api/subscribe-mailchimp/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken'),
                    },
                    body: JSON.stringify({ email }),
                });

                if (response.ok) {
                    emailInput.value = '';
                    submitBtn.textContent = 'Subscribed!';
                    setTimeout(() => {
                        submitBtn.textContent = originalBtnText;
                        submitBtn.disabled = false;
                    }, 3000);
                } else {
                    const data = await response.json();
                    alert(data.error || 'Subscription failed.');
                    submitBtn.textContent = originalBtnText;
                    submitBtn.disabled = false;
                }
            } catch (error) {
                console.error('Subscription error:', error);
                alert('An error occurred. Please try again.');
                submitBtn.textContent = originalBtnText;
                submitBtn.disabled = false;
            }
        }

        document.querySelector('footer form').addEventListener('submit', handleSubscription);
    </script>
</body>

</html>